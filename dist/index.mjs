import e,{useEffect as t,useReducer as n,useCallback as r,useRef as o}from"react";var i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var a,s,l=(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e);function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=13,c=9,u=8,d=89,p=90,f=77,h=57,y=219,g=222,m=192,v=100,_=3e3,b="navigator"in i&&/Win/i.test(navigator.platform),S="navigator"in i&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),C="npm__react-simple-code-editor__textarea",k=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,a=Array(i),C=0;C<i;C++)a[C]=arguments[C];return n=o=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),o.state={capture:!0},o._recordCurrentState=function(){var e=o._input;e&&o._recordChange({value:e.value,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd})},o._getLines=function(e,t){return e.substring(0,t).split("\n")},o._recordChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=o._history,i=n.stack,a=n.offset;if(i.length&&a>-1){o._history.stack=i.slice(0,a+1);var s=o._history.stack.length;if(s>v){var l=s-v;o._history.stack=i.slice(l,s),o._history.offset=Math.max(o._history.offset-l,0)}}var c=Date.now();if(t){var u=o._history.stack[o._history.offset];if(u&&c-u.timestamp<_){var d=/[^a-z0-9]([a-z0-9]+)$/i,p=o._getLines(u.value,u.selectionStart).pop().match(d),f=o._getLines(e.value,e.selectionStart).pop().match(d);if(p&&f&&f[1].startsWith(p[1]))return void(o._history.stack[o._history.offset]=r({},e,{timestamp:c}))}}o._history.stack.push(r({},e,{timestamp:c})),o._history.offset++},o._updateInput=function(e){var t=o._input;t&&(t.value=e.value,t.selectionStart=e.selectionStart,t.selectionEnd=e.selectionEnd,o.props.onValueChange(e.value))},o._applyEdits=function(e){var t=o._input,n=o._history.stack[o._history.offset];n&&t&&(o._history.stack[o._history.offset]=r({},n,{selectionStart:t.selectionStart,selectionEnd:t.selectionEnd})),o._recordChange(e),o._updateInput(e)},o._undoEdit=function(){var e=o._history,t=e.offset,n=e.stack[t-1];n&&(o._updateInput(n),o._history.offset=Math.max(t-1,0))},o._redoEdit=function(){var e=o._history,t=e.stack,n=e.offset,r=t[n+1];r&&(o._updateInput(r),o._history.offset=Math.min(n+1,t.length-1))},o._handleKeyDown=function(e){var t=o.props,n=t.tabSize,r=t.insertSpaces,i=t.ignoreTabKey,a=t.onKeyDown;if(!a||(a(e),!e.defaultPrevented)){var s=e.target,v=s.value,_=s.selectionStart,C=s.selectionEnd,k=(r?" ":"     ").repeat(n);if(e.keyCode===c&&!i&&o.state.capture)if(e.preventDefault(),e.shiftKey){var E=o._getLines(v,_),O=E.length-1,x=o._getLines(v,C).length-1,w=v.split("\n").map(function(e,t){return t>=O&&t<=x&&e.startsWith(k)?e.substring(k.length):e}).join("\n");if(v!==w)o._applyEdits({value:w,selectionStart:E[O].startsWith(k)?_-k.length:_,selectionEnd:C-(v.length-w.length)})}else if(_!==C){var K=o._getLines(v,_),j=K.length-1,D=o._getLines(v,C).length-1,L=K[j];o._applyEdits({value:v.split("\n").map(function(e,t){return t>=j&&t<=D?k+e:e}).join("\n"),selectionStart:/\S/.test(L)?_+k.length:_,selectionEnd:C+k.length*(D-j+1)})}else{var I=_+k.length;o._applyEdits({value:v.substring(0,_)+k+v.substring(C),selectionStart:I,selectionEnd:I})}else if(e.keyCode===u){var M=_!==C;if(v.substring(0,_).endsWith(k)&&!M){e.preventDefault();var T=_-k.length;o._applyEdits({value:v.substring(0,_-k.length)+v.substring(C),selectionStart:T,selectionEnd:T})}}else if(e.keyCode===l){if(_===C){var P=o._getLines(v,_).pop().match(/^\s+/);if(P&&P[0]){e.preventDefault();var z="\n"+P[0],F=_+z.length;o._applyEdits({value:v.substring(0,_)+z+v.substring(C),selectionStart:F,selectionEnd:F})}}}else if(e.keyCode===h||e.keyCode===y||e.keyCode===g||e.keyCode===m){var R=void 0;e.keyCode===h&&e.shiftKey?R=["(",")"]:e.keyCode===y?R=e.shiftKey?["{","}"]:["[","]"]:e.keyCode===g?R=e.shiftKey?['"','"']:["'","'"]:e.keyCode!==m||e.shiftKey||(R=["`","`"]),_!==C&&R&&(e.preventDefault(),o._applyEdits({value:v.substring(0,_)+R[0]+v.substring(_,C)+R[1]+v.substring(C),selectionStart:_,selectionEnd:C+2}))}else(S?e.metaKey&&e.keyCode===p:e.ctrlKey&&e.keyCode===p)&&!e.shiftKey&&!e.altKey?(e.preventDefault(),o._undoEdit()):(S?e.metaKey&&e.keyCode===p&&e.shiftKey:b?e.ctrlKey&&e.keyCode===d:e.ctrlKey&&e.keyCode===p&&e.shiftKey)&&!e.altKey?(e.preventDefault(),o._redoEdit()):e.keyCode!==f||!e.ctrlKey||S&&!e.shiftKey||(e.preventDefault(),o.setState(function(e){return{capture:!e.capture}}))}},o._handleChange=function(e){var t=e.target,n=t.value;o._recordChange({value:n,selectionStart:t.selectionStart,selectionEnd:t.selectionEnd},!0),o.props.onValueChange(n)},o._history={stack:[],offset:-1},s(o,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),o(t,[{key:"componentDidMount",value:function(){this._recordCurrentState()}},{key:"render",value:function(){var e=this,t=this.props,n=t.value,o=t.style,i=t.padding,s=t.highlight,l=t.textareaId,c=t.autoFocus,u=t.disabled,d=t.form,p=t.maxLength,f=t.minLength,h=t.name,y=t.placeholder,g=t.readOnly,m=t.required,v=t.onClick,_=t.onFocus,b=t.onBlur,S=t.onKeyUp,k=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(t,["value","style","padding","highlight","textareaId","autoFocus","disabled","form","maxLength","minLength","name","placeholder","readOnly","required","onClick","onFocus","onBlur","onKeyUp","onKeyDown","onValueChange","tabSize","insertSpaces","ignoreTabKey"]),O={paddingTop:i,paddingRight:i,paddingBottom:i,paddingLeft:i},x=s(n);return a.createElement("div",r({},k,{style:r({},E.container,o)}),a.createElement("textarea",{ref:function(t){return e._input=t},style:r({},E.editor,E.textarea,O),className:C,id:l,value:n,onChange:this._handleChange,onKeyDown:this._handleKeyDown,onClick:v,onKeyUp:S,onFocus:_,onBlur:b,disabled:u,form:d,maxLength:p,minLength:f,name:h,placeholder:y,readOnly:g,required:m,autoFocus:c,autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"data-gramm":!1}),a.createElement("pre",r({"aria-hidden":"true",style:r({},E.editor,E.highlight,O)},"string"==typeof x?{dangerouslySetInnerHTML:{__html:x+"<br />"}}:{children:x})),a.createElement("style",{type:"text/css",dangerouslySetInnerHTML:{__html:"\n/**\n * Reset the text fill color so that placeholder is visible\n */\n.npm__react-simple-code-editor__textarea:empty {\n  -webkit-text-fill-color: inherit !important;\n}\n\n/**\n * Hack to apply on some CSS on IE10 and IE11\n */\n@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {\n  /**\n    * IE doesn't support '-webkit-text-fill-color'\n    * So we use 'color: transparent' to make the text transparent on IE\n    * Unlike other browsers, it doesn't affect caret color in IE\n    */\n  .npm__react-simple-code-editor__textarea {\n    color: transparent !important;\n  }\n\n  .npm__react-simple-code-editor__textarea::selection {\n    background-color: #accef7 !important;\n    color: transparent !important;\n  }\n}\n"}}))}},{key:"session",get:function(){return{history:this._history}},set:function(e){this._history=e.history}}]),t}();k.defaultProps={tabSize:2,insertSpaces:!0,ignoreTabKey:!1,padding:0},n.default=k;var E={container:{position:"relative",textAlign:"left",whiteSpace:"pre-wrap",wordBreak:"keep-all",boxSizing:"border-box",padding:0},textarea:{position:"absolute",top:0,left:0,height:"100%",width:"100%",margin:0,border:0,resize:"none",background:"none",overflow:"hidden",color:"inherit",MozOsxFontSmoothing:"grayscale",WebkitFontSmoothing:"antialiased",WebkitTextFillColor:"transparent"},highlight:{position:"relative",margin:0,border:0,pointerEvents:"none"},editor:{boxSizing:"inherit",display:"inherit",fontFamily:"inherit",fontSize:"inherit",fontStyle:"inherit",fontVariantLigatures:"inherit",fontWeight:"inherit",letterSpacing:"inherit",lineHeight:"inherit",tabSize:"inherit",textIndent:"inherit",textRendering:"inherit",textTransform:"inherit",whiteSpace:"inherit",wordBreak:"inherit"}}}(a={exports:{}},a.exports),a.exports),c=(s=l)&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s;function u(e){return{end:e.selectionEnd,start:e.selectionStart}}export default function(i){var a,s=i.initialValue,l=i.formatCode,d=i.formatOnSave,p=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===t.indexOf(r)&&(n[r]=e[r]);return n}(i,["initialValue","formatCode","formatOnSave"]),f=n((a={formatCode:l},function(e,t){switch(t.type){case"EDIT":return Object.assign({},e,{code:t.payload});case"COMMENT_LINE":var n=t.payload,r=n.lineNumber,o=n.selectionState,i=!1,s=e.code.split("\n").reduce(function(e,t,n){return n+1===r?(t.startsWith("// ")&&(i=!0),e.concat([t.startsWith("// ")?t.split("// ")[1]:"// "+t])):e.concat([t])},[]).join("\n");return Object.assign({},e,{selectionState:o,code:s,didRemoveComment:i});case"FORMAT_CODE":return Object.assign({},e,{code:a.formatCode(e.code),selectionState:t.payload});default:return e}}),{code:s,selectionState:{end:0,start:0},didRemoveComment:!1}),h=f[0],y=f[1],g=o(null),m=o(!1);t(function(){g.current=document.querySelector("#react-complex-code-editor--element"),m.current=navigator.userAgent.includes("Mac OS X")},[]),t(function(){g.current.selectionEnd=h.didRemoveComment?h.selectionState.start-3:h.selectionState.start+3,g.current.selectionStart=h.didRemoveComment?h.selectionState.start-3:h.selectionState.start+3},[h.selectionState,h.didRemoveComment]);var v=r(function(e){if("/"===e.key&&m.current&&e.metaKey||"/"===e.key&&!m.current&&e.ctrlKey){var t=u(g.current),n=h.code.substr(0,t.start).split("\n").length;y({type:"COMMENT_LINE",payload:{lineNumber:n,selectionState:t}})}else if(d&&"function"==typeof l&&("s"===e.key&&m.current&&e.metaKey||"s"===e.key&&!m.current&&e.ctrlKey)){var r=u(g.current);e.preventDefault(),y({type:"FORMAT_CODE",payload:r})}},[h.code]),_=r(function(e){return y({type:"EDIT",payload:e})},[]);return e.createElement(c,Object.assign({},p,{value:h.code,onValueChange:_,textareaId:"react-complex-code-editor--element",onKeyDown:v}))}
//# sourceMappingURL=index.mjs.map
